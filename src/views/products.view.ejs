<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Products</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />


</head>

<body class="bg-light">
    <%- include('layouts/nav.ejs') %>

    <div class="container-fluid px-3 px-lg-4 mt-3">
        <div class="row">

            <!-- SIDEBAR COLUMN -->
            <aside class="col-lg-2 col-md-3">
                <%- include('partials/sidebar.ejs') %>
            </aside>

            <main class="col-lg-9 col-md-8">
                <!-- Header / Controls -->
                <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">

                    <!-- Title + Count -->
                    <div>
                        <h4 class="fw-bold mb-0">Products</h4>
                        <small class="text-muted">
                            <%= products.length %> item<%= products.length !== 1 ? 's' : '' %>
                        </small>
                    </div>

                    <!-- Controls -->
                    <div class="d-flex align-items-center gap-2">

                        <!-- Sort -->
                        <form method="GET">
                            <select name="sort" class="form-select form-select-sm" onchange="applySort(this.value)">
                                <option value="">Sort by</option>
                                <option value="price_asc">Price: Low → High</option>
                                <option value="price_desc">Price: High → Low</option>
                                <option value="latest">Newest</option>
                            </select>
                        </form>

                        <!-- Grid Density Toggle -->
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-secondary" onclick="setGrid('dense')"
                                title="Compact view">
                                <i class="bi bi-grid-3x3-gap"></i>
                            </button>
                            <button type="button" class="btn btn-outline-secondary active" onclick="setGrid('normal')"
                                title="Normal view">
                                <i class="bi bi-grid"></i>
                            </button>
                        </div>

                    </div>
                </div>

                <!-- Products Grid -->
                <% if (products.length > 0) { %>
                <div id="productGrid" class="row g-3 normal-grid">
                    <% products.forEach(product => { %>
                    <%- include('partials/product-card', { product }) %>
                    <% }) %>
                </div>
                <% } else { %>
                <!-- Empty State -->
                <div class="text-center py-5">
                    <i class="bi bi-box-seam fs-1 text-muted"></i>
                    <h5 class="mt-3">No products found</h5>
                    <p class="text-muted mb-3">
                        Try adjusting filters or add a new product.
                    </p>
                    <a href="/web/product/add" class="btn btn-primary">
                        Add Product
                    </a>
                </div>
                <% } %>

            </main>

        </div>
    </div>


    <!-- SUCCESS TOAST -->
    <% if (success && success.length > 0) { %>
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div class="toast show align-items-center text-white bg-success border-0">
            <div class="d-flex">
                <div class="toast-body">
                    <%= success[0] %>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto"></button>
            </div>
        </div>
    </div>
    <% } %>
    <%- include("layouts/footer.ejs") %>
    <!-- ERROR TOAST -->
    <% if (error && error.length > 0) { %>
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div class="toast show align-items-center text-white bg-danger border-0">
            <div class="d-flex">
                <div class="toast-body">
                    <%= error[0] %>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto"></button>
            </div>
        </div>
    </div>
    <% } %>
    <script>
        setTimeout(() => {
            document.querySelectorAll(".toast").forEach(toast => toast.remove());
        }, 3000);
        function setGrid(type) {
            const grid = document.getElementById("productGrid");
            grid.classList.remove("normal-grid", "dense-grid");
            grid.classList.add(type + "-grid");

            document
                .querySelectorAll(".btn-group .btn")
                .forEach(btn => btn.classList.remove("active"));

            event.target.closest("button").classList.add("active");
        }
    </script>
    <style>
        /* Normal grid (default) */
        .normal-grid>div {
            transition: all 0.2s ease;
        }

        /* Dense grid = more cards per row */
        .dense-grid>div {
            flex: 0 0 auto;
        }

        @media (min-width: 1400px) {
            .normal-grid>div {
                width: 25%;
                /* 4 cards */
            }

            .dense-grid>div {
                width: 16.66%;
                /* 6 cards */
            }
        }

        @media (min-width: 992px) and (max-width: 1399px) {
            .normal-grid>div {
                width: 33.33%;
                /* 3 cards */
            }

            .dense-grid>div {
                width: 25%;
                /* 4 cards */
            }

            aside {
                max-width: 260px;
                /* hard limit */
            }

            @media (max-width: 992px) {
                aside {
                    max-width: 100%;
                }
            }
        }
    </style>
    <script>
        function applySort(sortValue) {
            const params = new URLSearchParams(window.location.search);

            if (sortValue)
            {
                params.set("sort", sortValue);
            } else
            {
                params.delete("sort");
            }

            window.location.href =
                window.location.pathname + "?" + params.toString();
        }
    </script>

</body>


</html>